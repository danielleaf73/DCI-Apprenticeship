Using Schema: Order Entry (OE)

Questions:
1. How much do single males spend on average?

WITH ot AS ( 
SELECT c.customer_id, AVG(order_total) AS avg_spent, COUNT(order_id) AS num_orders 
FROM oe.customers c 
INNER JOIN oe.orders o 
    ON o.customer_id = c.customer_id 
GROUP BY c.customer_id 
) 

SELECT cust_first_name, cust_last_name, ROUND(ot.avg_spent, 2) AS average_spent,
    ot.num_orders AS number_of_orders, gender, marital_status
FROM oe.customers c 
INNER JOIN ot 
    ON ot.customer_id = c.customer_id 
WHERE marital_status = 'single' 
    AND gender = 'M' 
ORDER BY average_spent DESC;

WITH ot AS ( 
SELECT c.customer_id, AVG(order_total) AS avg_spent, COUNT(order_id) AS num_orders 
FROM oe.customers c 
INNER JOIN oe.orders o 
    ON o.customer_id = c.customer_id 
GROUP BY c.customer_id 
)

SELECT ROUND(AVG(ot.avg_spent), 2) AS average_spent, gender, marital_status
FROM oe.customers c 
INNER JOIN ot 
    ON ot.customer_id = c.customer_id 
WHERE marital_status = 'single' 
    AND gender = 'M' 
GROUP BY gender, marital_status
ORDER BY average_spent DESC;



2. Which orderable products are the most and least popular?

SELECT p.product_name, c.category_description, COUNT(*) AS number_of_orders
FROM oe.product_information p
LEFT JOIN oe.order_items oi
    ON p.product_id = oi.product_id
LEFT JOIN oe.categories_tab c
    ON c.category_id = p.category_id
WHERE p.product_status = 'orderable'
GROUP BY p.product_name, c.category_description
ORDER BY number_of_orders DESC;

SELECT p.product_name, c.category_description, COUNT(*) AS number_of_orders
FROM oe.product_information p
LEFT JOIN oe.order_items oi
    ON p.product_id = oi.product_id
LEFT JOIN oe.categories_tab c
    ON c.category_id = p.category_id
WHERE p.product_status = 'orderable'
GROUP BY p.product_name, c.category_description
ORDER BY number_of_orders;



3. How much is spent on software?

SELECT c.category_name, c.category_description, SUM(oi.unit_price) AS total_revenue, SUM(oi.quantity) AS total_number
FROM oe.categories_tab c
LEFT JOIN oe.product_information p
ON p.category_id = c.category_id
LEFT JOIN oe.order_items oi
ON oi.product_id = p.product_id
WHERE c.category_name LIKE 'software%'
GROUP BY c.category_name, c.category_description
ORDER BY total_revenue;

SELECT SUM(oi.unit_price) AS total_revenue, SUM(oi.quantity) AS total_number
FROM oe.categories_tab c
LEFT JOIN oe.product_information p
ON p.category_id = c.category_id
LEFT JOIN oe.order_items oi
ON oi.product_id = p.product_id
WHERE c.category_name LIKE 'software%';
